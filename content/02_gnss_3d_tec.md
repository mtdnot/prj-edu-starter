---
title: "衛星電波で「地面」と「空」を同時に観測する：GNSSから3D測位と宇宙天気（TEC）まで"
date: 2026-01-19
slug: gnss-3d-positioning-tec
summary: "GNSS（GPS等）の衛星電波から3D位置（地殻変動）と電離圏TEC（宇宙天気）を同時観測する仕組みをL0〜L8のレイヤー別に解説"
tags: ["gnss", "tec", "ionosphere", "positioning", "space-weather"]
status: published
---

# 衛星電波で「地面」と「空」を同時に観測する：GNSSから3D測位と宇宙天気（TEC）まで（L0〜L8）

このページは **1つのテーマを、L0（完全一般）→L8（研究者向け）へ一本道で"同じ結論を言い直す"**形式の原稿ドラフトです。
「高校数学の美しい物語」のように、**読者が自分のレベルから読めて、下に行くほど厳密になる**構造を意識しています。 ([学びTimes][1])

---

## 共通の結論（全レイヤーで同じ）

GNSS（GPSなど）は

* **衛星電波の到着時刻**を観測し、そこから

  1. 受信機の**3D位置（地面の動き＝地殻変動）**
  2. 電離圏の**TEC（宇宙天気の一部）**
     を推定できる。

ただしこれは「観測」まで。
**地震の"明日どこで起きる"のような予知**は別問題で、観測だけで直ちに成立するわけではない（検証設計が必要）。

---

## このページで扱うもの・扱わないもの

**扱う（観測のロジック）**

* 観測量 → 物理モデル（公式） → 推定 → 3D位置 / TEC
* どこに仮定が入るか、どこから先が"研究"になるか

**扱わない（実装の細部）**

* 具体的なコード、ライブラリ、手順書、コマンド
* 「これで地震が当たる」のような断定

---

# L0：完全一般（数式なしで"何が観測できるか"だけ掴む）

### 何が起きている？

* GNSS衛星は、常に「今の時刻」を電波で送っています。
* 地上の受信機は、その電波が**いつ届いたか**を測ります。
* 電波は光と同じくらい速いので、
  **ちょっとした時間差**が、そのまま**距離の差**になります。

### それで何がわかる？

* 複数の衛星からの距離がわかると、受信機の位置（3D）が決まります。
  これで **地面がどれだけ動いたか（地殻変動）** が見えます。
* でも電波は、地球の空（電離圏や大気）を通るので、少し遅れます。
* GNSSは**周波数の違う電波**を使えるので、遅れ方の違いから
  **電離圏にどれくらい電子が多いか（TEC）**も見えてきます。
  TECは宇宙天気（太陽活動の影響など）の観測に役立ちます。 ([GSSC][2])

---

# L1：中学〜高校（距離＝速さ×時間、そして「4機必要」）

### 距離は時間差で出る

* 基本はこれだけです：
  **距離 ＝ 速さ × 時間**
* 電波の速さはほぼ光速 ($c$)。だから
  
  $$D = c \cdot \Delta T$$
  
  で「見かけの距離（擬似距離）」が作れます。 ([GSSC][3])

### なぜ衛星は3機じゃなく4機？

* 3Dの位置は未知数が3つ（x, y, z）。
* でも受信機の時計は、原子時計ほど正確じゃない。
  **時計のズレ（未知数）がもう1つ**増えます。
* 未知数4つ（x, y, z, 時計ズレ）を解くには、最低4本の観測が必要 → **衛星4機以上**。

### "空のせい"も見える

* 電離圏は電波を少し遅らせます。
* 遅れ方は周波数によって変わるので、2種類の周波数を比べると、空（電離圏）の影響を推定できます。 ([GSSC][2])

---

# L2：高校〜大学入門（式を読む：幾何距離と補正の足し算）

ここから「何が混ざっているか」を式で"見える化"します。

### 幾何距離（本当の距離）

衛星位置 $\mathbf{x}^s$、受信機位置 $\mathbf{x}_r$ として

$$\rho_r^s = |\mathbf{x}^s - \mathbf{x}_r|$$

が幾何距離です。

### 擬似距離（現実の観測）は「いろいろ混ざる」

観測される擬似距離 $P$ は、ざっくり

$$P \approx \rho + \text{時計} + \text{大気} + \text{電離圏} + \text{ノイズ}$$

みたいな"足し算"になります。

この「足し算に分解して、未知数を推定する」という発想がGNSS観測の骨格です。 ([GSSC][4])

---

# L3：大学理系（観測方程式：コードと搬送波位相）

GNSSの主役は **コード（擬似距離）** と **搬送波位相**です。

### コード擬似距離（P）

$$
P_{r,i}^{s} = \rho_{r}^{s} + c(\delta t_r - \delta t^{s}) + T_{r}^{s} + I_{r,i}^{s} + b_{P} + \varepsilon_P
$$

### 搬送波位相（Φ）

$$
\Phi_{r,i}^{s} = \rho_{r}^{s} + c(\delta t_r - \delta t^{s}) + T_{r}^{s} - I_{r,i}^{s} + \lambda_i N_{r,i}^{s} + b_{\Phi} + \varepsilon_\Phi
$$

ポイントは3つ：

1. 時計ズレ $c(\delta t_r-\delta t^s)$ が入る
2. 対流圏 $T$ は周波数にほぼ依らない（ここでは詳細略）
3. 電離圏 $I$ は **コードと位相で符号が逆**、しかも周波数依存 ([GSSC][4])

---

# L4：推定（最小二乗で3D位置を"観測値"として作る）

観測方程式は非線形（$\rho=|\cdot|$）なので、近似点まわりで線形化して

$$\mathbf{y} \approx \mathbf{H}\mathbf{u} + \varepsilon$$

として解きます。定番は重み付き最小二乗：

$$\hat{\mathbf{u}} = (\mathbf{H}^T\mathbf{W}\mathbf{H})^{-1}\mathbf{H}^T\mathbf{W}\mathbf{y}$$

ここで、教育用に強調したいのは結果よりも構造です：

* **H（幾何）**：衛星がどっち方向に見えているか（視線方向）
* **W（信頼度）**：仰角が低い観測は誤差が増える、など
* **y（残差）**：補正しきれないものが"誤差"として残る

この「推定問題」としての見方が、地震でも宇宙天気でも共通の土台になります。

---

# L5：高精度（cm〜mm）になると何が増える？（測地・地殻変動の入口）

測位を「ナビ」から「観測」に変えると、論点が増えます。

### 3D座標 → 3D変位（ENU）

推定したECEF座標 $(X,Y,Z)$ を、基準時刻 $t_0$ との差

$$\Delta \mathbf{X}(t) = \mathbf{X}(t) - \mathbf{X}(t_0)$$

にして、局所座標（東E・北N・上U）へ回転します。

これで得られる **E/N/U の時系列**が、地殻変動（地面の動き）の観測の基本形です。

### なぜ搬送波位相が重要？

* 位相はノイズが小さい → 高精度
* ただし $\lambda N$（整数不定性）が入る → 解く工夫が必要

### "差を取る"という設計思想

高精度の世界では、
「同じ誤差を共有するもの同士で差を取って消す」
（例：受信機間差、衛星間差）という発想が頻出します。

※ここまでで、**地震に関連し得る"地面の観測"**はできます。
ただし、これだけで"予知"は言えません。予知は評価設計が別途必要。

---

# L6：宇宙天気（TEC）をGNSSで観測する（周波数依存＝鍵）

ここから「空の観測」に寄せます。GNSSで宇宙天気をやるなら中心はTECです。

### 電離圏遅延はTECに比例し、周波数の二乗に反比例

電離圏による遅延（距離換算）は概形として

$$I_f \propto \frac{1}{f^2} \cdot \text{STEC}$$

ここで

$$\text{STEC} = \int N_e \, dl$$

が電子密度 $N_e$ の線積分（Slant TEC）です。 ([GSSC][2])

### 二周波差（geometry-free）で電離圏だけを浮かび上がらせる

2周波 $f_1, f_2$ の観測を組み合わせると、幾何や時計が消えて電離圏が残ります（理想化して言うと）。
Navipediaの整理では、係数として **40.3** が現れる形で書かれます。 ([GSSC][5])

### STEC → VTEC（薄膜モデル）

宇宙天気では地図として扱いたいので、天頂方向に換算してVTECへ：

$$\text{STEC} = M(E) \cdot \text{VTEC}$$

（$E$ は仰角、$M$ は写像関数）

### IONEXという交換フォーマット

VTECマップを配布・交換する標準がIONEXです（2D/3D TECマップ交換を目的に設計）。 ([IGS Files][6])

---

# L7：3D電子密度へ（TECから"密度分布"に行くと逆問題になる）

ここが「教育にも研究にも大事な境界線」です。

### GNSSが直接くれるのは"密度そのもの"ではない

GNSSが強いのは

$$\text{STEC} = \int N_e \, dl$$

という **線積分**です。
つまり、電子密度 $N_e(\mathbf{r})$ を直接見ているわけではありません。

### 3Dにするにはトモグラフィ（逆問題）

空間をボクセルに区切って

$$\mathbf{y} = \mathbf{A}\mathbf{x} + \varepsilon$$

* $\mathbf{y}$：観測されたSTECの列
* $\mathbf{x}$：各ボクセルの電子密度（未知）
* $\mathbf{A}$：光線が各ボクセルを通る距離（既知）

ただしこれは不安定になりがちなので、正則化を入れて解きます：

$$\hat{\mathbf{x}} = \arg\min \left( |\mathbf{A}\mathbf{x}-\mathbf{y}|^2 + \mu|\mathbf{L}\mathbf{x}|^2 \right)$$

**ここで何が"未確定"か**（=研究の余地）は明確で、

* ボクセルの切り方
* 正則化の選び方
* 観測網（衛星×受信機の幾何）の偏り

が結果に影響します。

---

# L8：研究として成立させるための「検証・再現・独立性」

最後は"物理式が正しくても、研究として誤るポイント"です。ここを最初から書くのが信用の源になります。

## 1) 宇宙天気としての落とし穴

* 電離圏は **太陽活動・時刻・場所**で大きく変わる（季節・昼夜・緯度の影響）。 ([GSSC][2])
* 磁気嵐・フレアなど、地震と無関係な要因でTECは普通に荒れる
  → 「地震の前だから増えた」と見える錯覚が起きやすい

## 2) 地殻変動としての落とし穴

* マルチパス、アンテナ交換、周辺環境変化で座標が"動いたように見える"
* モデル誤差（対流圏・潮汐など）が残差に混ざる
  → 観測だけで結論を急がない

## 3) 地震に接続するなら必須（ここが"予知"との境目）

地震の話に踏み込むなら、最低限：

* いつ・どこを「異常」と定義するか
* 外れたときも含めた評価（予測の検定）
* 事前にルールを固定する（後出しをしない）

を先に置く必要があります。
（このページ自体は"観測の基礎"なので、検定の詳細は別記事に独立させるのが相性良いです。）

## 4) データ形式を「一次資料」で固定する

あなたの狙い（公開知の不足を埋める）に直結します。

* 観測データ交換：**RINEX**（IGS/RTCMが仕様を管理） ([igs.org][7])
* 電離圏マップ交換：**IONEX**（仕様PDFがある） ([IGS Files][6])
* 「仕様へのリンク」だけでなく、**"仕様のどこを読めば何が分かるか"**の道案内を書く
  → ここが教育的価値として非常に大きいです。

---

## このページを「独立記事」へ分割するなら（おすすめ分割案）

あなたの要望「地震予知に限らず、宇宙天気目的でも使えるよう独立させる」に合わせて、同じレイヤー構造を保ったまま分割できます。

1. **GNSSの基本観測量：擬似距離と位相（L0〜L8）** ([GSSC][3])
2. **3D測位＝推定問題：線形化と最小二乗（L0〜L8）**
3. **座標時系列から地殻変動を観測する（ENU、ステップ、速度）（L0〜L8）**
4. **電離圏遅延とTEC：周波数依存で分離する（L0〜L8）** ([GSSC][2])
5. **IONEX入門：VTECマップの読み方・注意点（L0〜L8）** ([IGS Files][6])
6. **RINEX入門：観測データが何を持っているか（L0〜L8）** ([igs.org][7])
7. **TECから電子密度へ：仮定とトモグラフィ（L0〜L8）**
8. **"地震に関係あるか"を語る前の統計検定（L0〜L8）**（別テーマとして独立推奨）

---

もし次の一歩として「実際にJupyter Bookの1ページ原稿として完成形にする」なら、上の分割案の **(4) 電離圏遅延とTEC** を選ぶのが一番"不足領域への貢献"になりやすいです。
理由は、一次資料（IONEX仕様）と観測式（周波数依存）まで一直線で繋がっていて、**地震目的にも宇宙天気目的にも共通で使える**からです。 ([IGS Files][6])

[1]: https://manabitimes.jp/math "高校数学の美しい物語"
[2]: https://gssc.esa.int/navipedia/index.php/Ionospheric_Delay "Ionospheric Delay - Navipedia"
[3]: https://gssc.esa.int/navipedia/index.php/GNSS_Basic_Observables "GNSS Basic Observables - Navipedia"
[4]: https://gssc.esa.int/navipedia/index.php/GNSS_Measurements_Modelling "GNSS Measurements Modelling - Navipedia"
[5]: https://gssc.esa.int/navipedia/index.php/Combining_pairs_of_signals_and_clock_definition "Combining pairs of signals and clock definition - Navipedia"
[6]: https://files.igs.org/pub/data/format/ionex1.pdf "ionex1.pdf"
[7]: https://igs.org/wg/rinex/ "RINEX"